<script>
var express = require("express");
var router = express.Router();

router.get("/", function(req, res, next) {

    var timeArray = [];
    var PsigArray = [];
    var GammaArray = [];
    var ZArray = [];
    var DzpsArray = [];
    var GammaZadArray = [];
    var DzpsArray = [];
    var DEleronivArray = [];
    var DHaprymkuArray = [];
    var StrumIkArray = [];
    var results = [];

    var dataResult5 = [];
    var dataResult6 = [];

    var myK = 0;
    var G = 80000;
    var m = G / 9.81;

    var p = 0.119;
    var S = 201.45;
    var V = 78;
    var ba = 5.285;
    var Iy = 900000;
    var Ix = 250000;
    var l = 37.55;
    var ab = 7.1;
    var qdv = 0.585;
    var H0 = 500;
    var Sk = 280;
    var dIk = 0;

    var C6 = V / 57.3;
    var a1 = (0.21 * p * V * S * l * l) / (4 * Iy);
    var a2 = (0.2 * p * V * V * S * l) / (2 * Iy);
    var a3 = (0.0716 * p * V * V * S * l) / (2 * Iy);
    var a4 = (1.0715 * p * V * S) / (2 * m);
    var a5 = (0.0206 * p * V * V * S * l) / (2 * Ix);
    var a6 = (0.31 * p * V * S * l * l) / (4 * Ix);
    var a7 = (0.183 * p * V * S) / (2 * m);
    var b1 = (0.583 * p * V * S * l * l) / (4 * Ix);
    var b2 = (0.186 * p * V * V * S * l) / (2 * Ix);
    var b3 = (0.0688 * p * V * V * S * l) / (2 * Ix);
    var b4 = (9.81 / V) * Math.cos(ab / 57.3);
    var b5 = 0;
    var b6 = (0.006 * p * V * S * l * l) / (4 * Iy);
    var b7 = Math.sin(ab / 57.3);

    var DE = 0;
    var DN = 0;
    var x = [];
    var y = [];
    var k5 = null;
    var k17 = null;
    var PSIg = null;
    var Ek = null;
    var Ekz = null;
    var Ikz = null;
    var Ik = null;
    var F1d = null;
    var F2d = null;
    var F1 = null;
    var F2 = null;
    var Fde = null;
    var Fdn = null;
    var Fk = null;

    var Dg = (57.3 * 500) / 2.67 - 300;
    for (var i = 0; i < 13; i++) {
        x[i] = 0;
        y[i] = 0;
    }
    var h = 0.05;
    y[0] = 0;
    y[5] = 2000;
    y[6] = 18000;

    var T = 0;

    while (y[6] > 0) {
        if (y[6] > Dg) {
            k5 = 2;
            k17 = 170;
        } else {
            k5 = 3;
            k17 = 120;
        }

        PSIg = -y[0];

        Ekz = 57.3 * Math.atan(y[5] / (y[6] + 4000));
        Ikz = Sk * Ekz + dIk;
        Ek = y[12] / 167;

        if (Ikz >= 250) {
            Fk = 250;
        } else if (Ikz < 250 && Ikz > -250) {
            Fk = Ikz;
        } else {
            Fk = -250;
        }

        F1d = -1.3 * PSIg + 8 * Ek;

        if (F1d >= 25) {
            F1 = 25;
        } else if (F1d < 25 && F1d > -25) {
            F1 = F1d;
        } else {
            F1 = -25;
        }

        F2d = 1.3 * PSIg + x[7] + x[8] + F1;

        if (F2d >= 20) {
            F2 = 20;
        } else if (F2d < 20 && F2d > -20) {
            F2 = F2d;
        } else {
            F2 = -20;
        }

        Fde = 2 * (y[1] - y[9]) + y[10];

        if (Fde >= 12) {
            DE = 12;
        } else if (Fde < 12 && Fde > -12) {
            DE = Fde;
        } else {
            DE = -12;
        }

        Fdn = 2.5 * y[2] + y[11];

        if (Fdn >= 10) {
            DN = 10;
        } else if (Fdn < 10 && Fdn > -10) {
            DN = Fdn;
        } else {
            DN = -10;
        }
        // DE = -1;

        if (T < 1) {
            DN = 1;
        } else {
            DN = 0;
        }

        x[0] = y[2];
        x[1] = y[3];
        x[2] = -a1 * x[0] - b6 * x[1] - a2 * y[4] - a3 * DN - b5 * DE;
        x[3] = -b1 * x[1] - a6 * x[0] - b2 * y[4] - a5 * DN - b3 * DE;
        x[4] = x[0] + b7 * x[1] + b4 * y[1] - a4 * y[4] - a7 * DN;
        x[5] = V * Math.sin((PSIg + y[4]) / 57.3);
        x[6] = -V * Math.cos((PSIg + y[4]) / 57.3);

        x[7] = (k5 * PSIg - y[7]) / 2.3; //5   DeltaPsi
        x[8] = (k17 * Ek - y[8]) / 2.3; //17   EpsilonK
        x[9] = -(F2 + y[9]) / 0.85; //15 Yzad  
        x[10] = 1.5 * x[3] - y[10] / 1.6; //DE
        x[11] = 2.5 * x[2] - y[11] / 2.5; //DN
        x[10] = 1.5 * y[3] - y[10] / 1.6;
        x[11] = 2.5 * y[2] - y[11] / 2.5;
        x[12] = (Fk - y[12]) / 0.2;

        for (var i = 0; i < 13; i++) {
            y[i] += x[i] * h;
        }

        var time = Math.round(T * 100) / 100;

        if (time % 5 == 0) {
            // var tr = document.createElement("tr");
            //results.appendChild(tr
      
            //td[0]  = document.createElement("td");
            timeArray.push(time);
            //tr.appendChild(td[0]);
            
            //td[1] = document.createElement("td");
            //td[1] = PSIg.toFixed(4);
            PsigArray.push(PSIg.toFixed(4));
            //tr.appendChild(td[1]);

            //td[2] = document.createElement("td");
            //td[2] =
            GammaArray.push(y[1].toFixed(7));
            //tr.appendChild(td[2]);

            //td[3] = document.createElement("td");
            //td[3] =  
            ZArray.push(y[5].toFixed(7));
            //tr.appendChild(td[3]);

            //td[4] = document.createElement("td");
            //td[4] = 
            DzpsArray.push(y[6].toFixed(7));
            //tr.appendChild(td[4]);

            //td[5] = document.createElement("td");
            //td[5] = y[9].toFixed(7);
            GammaZadArray.push(y[9].toFixed(7))
            //tr.appendChild(td[5]);

            //td[6] = document.createElement("td");
            //td[6] = 
            DEleronivArray.push(DN.toFixed(7));
            
            //tr.appendChild(td[6]);

            //td[7] = document.createElement("td");
            //td[7] = DE.toFixed(7);
            DHaprymkuArray.push(DE.toFixed(7));
            //tr.appendChild(td[7]);

            //td[8] = document.createElement("td");
            //
            //td[8] = 
            StrumIkArray.push(y[12].toFixed(7));
            //tr.appendChild(td[8]);

            results.push({timeArray: time, PsigArray: PSIg.toFixed(4), GammaArray: y[1].toFixed(7), ZArray: y[5].toFixed(7), DzpsArray: y[6].toFixed(7), GammaZadArray: y[9].toFixed(7), DEleronivArray: DN.toFixed(7), DHaprymkuArray: DE.toFixed(7), StrumIkArray: y[12].toFixed(7)});

            //el1and2[i] = { arr1: [Y1[i], X1[i], X2[i]], arr2: [X2[i], Y2[i]]};
        }
        T += h;

        dataResult5[myK] = [];
        dataResult5[myK][1] = y[5];
        dataResult5[myK][0] = y[6];
        // dataResult5[myK] = [];
        // dataResult5[myK][1] = y[3];
        // dataResult5[myK][0] = T;

        //  dataResult6[myK] = [];
        // dataResult6[myK][1] = y[2];
        // dataResult6[myK][0] = T;
        myK++;
    }


    res.render("index", {
        title: "Express",
        with1method: dataResult5,
        results: results
        //timeArray: timeArray
    });
});



module.exports = router;
</script>